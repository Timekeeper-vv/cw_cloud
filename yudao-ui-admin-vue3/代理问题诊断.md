# Vite 代理问题诊断

## 问题现象
- 前端请求 `POST /monitor/realtime/analyze` 时出现 `ERR_CONNECTION_RESET`
- **关键：没有看到 `[Vite Proxy]` 日志，说明 Vite 代理可能未生效**

## 服务状态
✅ 网关 (48080): 运行中  
✅ Monitor (48090): 运行中  
✅ Vite (3000): 运行中  

## 解决方案

### 步骤 1: 重启 Vite 开发服务器

**重要：Vite 代理配置的更改需要重启开发服务器才能生效！**

1. 停止当前的 Vite 开发服务器：
   - 在运行 Vite 的终端窗口按 `Ctrl+C`

2. 重新启动 Vite 开发服务器：
   ```bash
   cd D:\CW_Cloud-main\yudao-ui-admin-vue3
   pnpm dev
   ```

3. 启动后，你应该在 Vite 终端看到：
   ```
   [Vite Proxy] 🚀 代理已启用: /admin-api -> http://localhost:48080
   ```

### 步骤 2: 验证代理是否工作

1. 打开浏览器控制台（F12）
2. 上传一个小的测试文件（< 1MB）
3. 查看控制台输出，应该看到：
   ```
   [Axios] 发起请求: POST /monitor/realtime/analyze
   [Vite Proxy] ➡️  POST /admin-api/monitor/realtime/analyze
   [Vite Proxy] 🎯 转发到: http://localhost:48080/admin-api/monitor/realtime/analyze
   [Vite Proxy] ⬅️  200 /admin-api/monitor/realtime/analyze
   [Axios] 收到响应: 200 /monitor/realtime/analyze
   ```

### 步骤 3: 如果仍然没有看到 [Vite Proxy] 日志

可能的原因：
1. Vite 版本不支持 `configure` 函数
2. `vite.config.ts` 没有正确加载

**临时解决方案：使用更简单的代理配置**

如果 `configure` 函数不工作，可以尝试移除它，使用基本的代理配置：

```typescript
'/admin-api': {
  target: 'http://localhost:48080',
  changeOrigin: true,
  secure: false,
  ws: true,
  // 移除 configure 函数
},
```

## 日志位置

### 浏览器控制台（F12）
- `[Axios]` 开头的日志
- `[Vite Proxy]` 开头的日志（如果代理工作）

### Vite 开发服务器终端
- `[Vite Proxy]` 开头的日志

### 网关日志
- `D:\CW_Cloud-main\yudao-cloud\yudao-gateway\logs\gateway.log`
- 查找包含 `monitor` 或 `realtime` 的日志

### Monitor 服务日志
- `D:\CW_Cloud-main\yudao-cloud\yudao-module-monitor\yudao-module-monitor-server\logs\monitor.log`
- 查找包含 `🔍 [Monitor]` 或 `📁 [Monitor]` 的日志

## 测试文件

已创建 `test-proxy.html` 文件，可以在浏览器中打开它来测试代理是否工作。
