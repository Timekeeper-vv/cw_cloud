# 🎯 信号滤波分析系统使用指南

## 📁 数据文件说明

### Signal-1 数据（单文件多通道）
- **位置**: `floatdata/signal-1/ae_sim_2s.tdms`
- **特点**: 一个文件包含多个通道（原始、噪声、混合）
- **处理脚本**: `signal-filter-visualizer.py`

### Signal-2 数据（多文件分离）
- **位置**: `floatdata/signal-2/`
- **文件**:
  - `ae_sine_2s.tdms` - 原始正弦波
  - `ae_noise_2s.tdms` - 纯噪声
  - `ae_mix_2s.tdms` - 混合信号
- **处理脚本**: `signal-filter-visualizer-v2.py`

---

## 🚀 快速开始

### 1. 安装依赖

```bash
pip install numpy matplotlib scipy nptdms
```

### 2. 运行分析脚本

#### 方式一：分析 Signal-1 数据

```bash
cd e:\Code\CW_Cloud\floatdata\floatdata-streaming
python signal-filter-visualizer.py
```

**输出**:
- `signal-1/signal_filter_comparison.png` - 时域对比图
- `signal-1/frequency_spectrum_comparison.png` - 频域对比图

#### 方式二：分析 Signal-2 数据

```bash
cd e:\Code\CW_Cloud\floatdata\floatdata-streaming
python signal-filter-visualizer-v2.py
```

**输出**:
- `signal-2/complete_signal_analysis.png` - 完整时域分析
- `signal-2/frequency_analysis.png` - 完整频域分析

---

## 📊 可视化内容详解

### 时域分析图（Time Domain）

#### Signal-1 输出（4个子图）
1. **原始信号** - 纯净的 5 kHz 正弦波
2. **加噪信号** - 原始信号 + 噪声（SNR=10dB）
3. **滤波后信号** - 经过低通滤波器处理
4. **效果对比** - 原始信号 vs 滤波后（叠加显示）

#### Signal-2 输出（5个子图）
1. **原始正弦波** - 纯净信号
2. **纯噪声** - 单独的噪声信号
3. **混合信号** - 原始 + 噪声
4. **滤波后信号** - 滤波处理结果
5. **效果对比** - 原始 vs 滤波后

### 频域分析图（Frequency Domain）

显示 FFT 频谱，观察：
- **原始信号**: 应该只在 5 kHz 处有峰值
- **加噪信号**: 宽频噪声掩盖了信号峰值
- **滤波后信号**: 高频噪声被抑制，5 kHz 峰值恢复

---

## 🔧 滤波器参数

### 当前配置
- **类型**: 巴特沃斯低通滤波器（Butterworth Lowpass Filter）
- **截止频率**: 10 kHz
- **阶数**: 6
- **设计理由**: 信号频率 5 kHz < 截止频率 10 kHz，可保留信号，过滤高频噪声

### 修改滤波器参数

如果需要调整滤波器，可以修改脚本中的参数：

```python
# 在脚本的 main() 函数中修改
visualizer.design_filter(
    cutoff_freq=10000,    # 截止频率（Hz）
    filter_type='lowpass', # 滤波器类型
    order=6                # 阶数（越高越陡峭）
)
```

**可选滤波器类型**:
- `'lowpass'` - 低通（保留低频）
- `'highpass'` - 高通（保留高频）
- `'bandpass'` - 带通（保留某个频段）

---

## 📈 性能评估指标

脚本会自动计算并输出：

### 1. 均方误差（MSE）
```
滤波前 MSE: 0.123456
滤波后 MSE: 0.012345
MSE 改善: 90.00%
```
- **越低越好**
- 衡量滤波后信号与原始信号的差异

### 2. 相关系数
```
滤波前相关系数: 0.7500
滤波后相关系数: 0.9800
```
- **越接近 1.0 越好**
- 衡量滤波后信号与原始信号的相似度

### 3. 频谱能量分布
- 通过频域图观察能量集中在 5 kHz
- 高频噪声被有效抑制

---

## 🎓 给邵老师的演示说明

### 数据准备
✅ **已准备两组数据**：
1. **Signal-1**: 单文件包含原始、噪声、混合信号（3通道）
2. **Signal-2**: 三个独立文件（原始、噪声、混合）

### 演示流程建议

#### 1. 展示原始数据（5分钟）
- 打开 `signal-1/note.txt` 说明信号参数
- 强调：采样率 100 kHz，信号 5 kHz，SNR=10dB

#### 2. 运行分析脚本（2分钟）
```bash
# 终端演示
python signal-filter-visualizer.py
python signal-filter-visualizer-v2.py
```

#### 3. 解读分析结果（10分钟）

**时域图重点**:
- 指出加噪后信号被噪声淹没
- 展示滤波后信号恢复效果
- 强调叠加图中两条曲线高度吻合

**频域图重点**:
- 原始信号：清晰的 5 kHz 峰值
- 加噪信号：峰值被宽频噪声掩盖
- 滤波后：高频噪声消失，5 kHz 峰值恢复

#### 4. 展示性能指标（3分钟）
- MSE 改善 > 90%
- 相关系数从 0.7x 提升到 0.9x
- 说明滤波效果显著

---

## 🔍 故障排查

### 问题1: 无法读取 TDMS 文件
```
解决: pip install nptdms
```

### 问题2: 中文显示乱码
```python
# 脚本已配置中文字体
plt.rcParams['font.sans-serif'] = ['SimHei', 'Microsoft YaHei']
```

### 问题3: 图片不显示
```python
# 脚本自动保存图片到数据文件夹
# 即使窗口关闭，也可以在文件夹中查看
```

---

## 📝 后续改进方向

1. **实时滤波**: 集成到 Kafka 流处理
2. **多种滤波器对比**: 巴特沃斯 vs 切比雪夫 vs FIR
3. **自适应滤波**: 根据信噪比自动调整参数
4. **批量处理**: 处理多个 TDMS 文件
5. **Web 界面**: 可视化展示和参数调节

---

## 🎉 总结

✅ **完成的功能**:
- [x] 加载原始信号和加噪信号
- [x] 设计并应用低通滤波器
- [x] 生成时域对比图（4-5个子图）
- [x] 生成频域对比图（3-4个子图）
- [x] 计算滤波性能指标
- [x] 自动保存高清图片

✅ **数据准备**:
- [x] Signal-1: 单文件多通道数据
- [x] Signal-2: 多文件分离数据
- [x] 两套方案满足不同演示需求

**脚本已经准备就绪，可以直接运行展示给邵老师！** 🚀
