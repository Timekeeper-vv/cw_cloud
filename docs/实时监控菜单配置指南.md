# 📋 实时监控菜单配置指南

## 🎯 概述

本指南说明如何将实时监控功能的前端页面添加到系统菜单中。

---

## 📦 菜单结构

添加后的菜单结构：

```
实时监控（monitor图标）
├── 实时滤波（data-line图标）
│   - WebSocket连接backend.jar
│   - 实时波形对比图
│   - 频谱分析
│   - 统计面板
│
├── 信号分析（data-analysis图标）
│   - 异常检测结果
│   - 统计图表
│   - 历史数据查询
│
└── 系统状态（circle-check图标）
    - 服务状态监控
    - 资源使用情况
    - 详细信息表
```

---

## 🚀 快速添加（推荐）

### 方式1：执行SQL脚本 ⭐⭐

**最快速的方式**

```bash
# 1. 双击运行
execute-realtime-menu-sql.bat

# 2. 输入MySQL密码（默认：123456）

# 3. 等待执行完成
```

执行后会自动：
- ✅ 添加4个菜单项
- ✅ 分配给超级管理员
- ✅ 验证插入结果

---

### 方式2：手动在管理界面添加 ⭐

如果不想执行SQL，可以手动添加：

#### 步骤1：添加一级菜单

登录后台 → 系统管理 → 菜单管理 → 新增

```
菜单名称：实时监控
菜单类型：目录
路由地址：/realtime
菜单图标：monitor
显示状态：显示
菜单状态：正常
```

#### 步骤2：添加子菜单1 - 实时滤波

```
上级菜单：实时监控
菜单名称：实时滤波
菜单类型：菜单
路由地址：filter
组件路径：realtime/FilterMonitor
菜单图标：data-line
权限标识：realtime:filter:query
显示状态：显示
菜单状态：正常
```

#### 步骤3：添加子菜单2 - 信号分析

```
上级菜单：实时监控
菜单名称：信号分析
菜单类型：菜单
路由地址：analysis
组件路径：realtime/SignalAnalysis
菜单图标：data-analysis
权限标识：realtime:analysis:query
显示状态：显示
菜单状态：正常
```

#### 步骤4：添加子菜单3 - 系统状态

```
上级菜单：实时监控
菜单名称：系统状态
菜单类型：菜单
路由地址：status
组件路径：realtime/SystemStatus
菜单图标：circle-check
权限标识：realtime:status:query
显示状态：显示
菜单状态：正常
```

---

## ✅ 验证菜单添加

### 1. 检查数据库

```sql
SELECT 
    id, name, path, component, icon, parent_id, sort
FROM 
    system_menu
WHERE 
    name IN ('实时监控', '实时滤波', '信号分析', '系统状态')
    AND deleted = '0'
ORDER BY 
    parent_id, sort;
```

应该看到4条记录。

### 2. 检查角色权限

```sql
SELECT 
    r.name AS '角色名称',
    m.name AS '菜单名称'
FROM 
    system_role_menu rm
    JOIN system_role r ON rm.role_id = r.id
    JOIN system_menu m ON rm.menu_id = m.id
WHERE 
    m.name IN ('实时监控', '实时滤波', '信号分析', '系统状态')
    AND rm.deleted = '0';
```

确认超级管理员有权限。

---

## 🔄 前端生效步骤

### 必须步骤

#### 1. 清除浏览器缓存

**方式A：使用清除工具**（推荐）
```
访问: http://localhost:3000/clear-and-relogin.html
点击: 一键清除并重新登录
```

**方式B：手动清除**
```
F12 → Application → Storage → Clear site data
或
Ctrl + Shift + Delete → 清除缓存
```

#### 2. 重新登录

```
地址: http://localhost:3000
账号: admin
密码: admin123
```

#### 3. 查看菜单

左侧菜单栏应该出现"实时监控"菜单，包含3个子菜单。

---

## 🎨 页面功能说明

### 1. 实时滤波页面

**访问路径**：`/realtime/filter`

**功能**：
- WebSocket连接backend.jar (ws://localhost:8080/cal)
- 实时显示原始信号和滤波后信号的波形对比
- 频谱分析图
- 实时统计信息（吞吐量、误差、SNR改善）
- 设备选择和滤波器类型切换

**依赖**：
- ✅ backend.jar必须在8080端口运行
- ✅ ECharts图表库
- ✅ WebSocket支持

**使用**：
1. 点击"开始监控"连接WebSocket
2. 选择设备和滤波器类型
3. 实时查看波形变化
4. 观察统计数据

---

### 2. 信号分析页面

**访问路径**：`/realtime/analysis`

**功能**：
- 异常检测结果列表
- 异常类型分布饼图
- 告警趋势折线图
- 历史数据查询
- 详情查看

**数据来源**：
- ⚠️ 当前使用模拟数据
- 🔄 实际应从floatdata的Kafka结果队列或数据库读取

**使用**：
1. 设置查询条件（设备ID、时间范围）
2. 点击查询查看结果
3. 点击"查看详情"查看异常详细信息

---

### 3. 系统状态页面

**访问路径**：`/realtime/status`

**功能**：
- 所有服务运行状态监控
- CPU/内存/网络使用率仪表盘
- 服务详细信息表格
- 一键刷新状态

**监控服务**：
- MySQL, Redis, Nacos, Kafka
- Gateway, System, IoT, Filter
- backend.jar, floatdata

**使用**：
1. 查看服务卡片状态（绿色=运行中，红色=已停止）
2. 查看资源使用情况
3. 点击"刷新"获取最新状态

---

## ⚠️ 常见问题

### 问题1：菜单不显示

**原因**：
- 浏览器缓存未清除
- 用户没有菜单权限
- 前端路由未配置

**解决**：
1. 清除浏览器缓存（重要！）
2. 检查用户角色是否有菜单权限
3. 确认 `src/router/modules/realtime.ts` 文件存在
4. 重启前端开发服务器

---

### 问题2：页面打开报错

**原因**：
- 组件文件不存在
- 组件路径配置错误
- 依赖缺失

**解决**：
1. 检查 `src/views/realtime/` 目录下的Vue文件是否存在
2. 确认组件路径与菜单配置一致
3. 安装ECharts：`npm install echarts`

---

### 问题3：WebSocket连接失败

**原因**：
- backend.jar未启动
- 端口8080被占用
- 跨域问题

**解决**：
1. 启动backend.jar：
   ```bash
   java -jar backend.jar --server.port=8080
   ```
2. 检查端口占用：
   ```bash
   netstat -ano | findstr ":8080"
   ```
3. 在浏览器控制台查看错误详情

---

### 问题4：图表不显示

**原因**：
- ECharts未安装
- 图表容器高度为0
- 数据格式错误

**解决**：
1. 安装ECharts：
   ```bash
   cd yudao-ui-admin-vue3
   npm install echarts
   ```
2. 检查CSS样式，确保容器有高度
3. 在控制台查看数据格式

---

## 🔄 回滚操作

如果需要删除菜单：

### 方式1：通过管理界面

1. 登录后台
2. 系统管理 → 菜单管理
3. 找到"实时监控"菜单
4. 点击删除（会同时删除所有子菜单）

### 方式2：执行SQL

```sql
-- 删除实时监控相关菜单
DELETE FROM system_menu 
WHERE name IN ('实时监控', '实时滤波', '信号分析', '系统状态')
AND deleted = '0';

-- 删除对应的角色权限
DELETE FROM system_role_menu 
WHERE menu_id IN (
    SELECT id FROM system_menu 
    WHERE name IN ('实时监控', '实时滤波', '信号分析', '系统状态')
);
```

---

## 📚 相关文件

| 文件 | 说明 |
|------|------|
| `add-realtime-menus.sql` | SQL脚本 |
| `execute-realtime-menu-sql.bat` | 执行脚本 |
| `src/router/modules/realtime.ts` | 路由配置 |
| `src/views/realtime/FilterMonitor.vue` | 实时滤波页面 |
| `src/views/realtime/SignalAnalysis.vue` | 信号分析页面 |
| `src/views/realtime/SystemStatus.vue` | 系统状态页面 |

---

## ✅ 完成检查清单

添加菜单后，确认以下项目：

- [ ] SQL执行成功，无错误
- [ ] 数据库中有4条菜单记录
- [ ] 超级管理员角色有菜单权限
- [ ] 浏览器缓存已清除
- [ ] 重新登录后台
- [ ] 左侧菜单栏显示"实时监控"
- [ ] 可以点击进入各个子菜单
- [ ] 页面正常显示，无报错
- [ ] 实时滤波页面能连接WebSocket（如果backend.jar运行中）

---

**创建时间**：2025-11-24  
**适用版本**：v1.0  
**维护人员**：项目组
