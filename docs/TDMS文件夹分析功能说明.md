# 📂 TDMS文件夹分析功能说明

## 🎯 问题解决

你提出的问题非常正确！之前的界面只能上传单个TDMS文件，但实际上你提供的是**两个文件夹**，里面的文件需要**一起读取**才能完整分析。

---

## 📊 数据结构理解

### Signal-1 文件夹（单文件多通道）
```
signal-1/
└── ae_sim_2s.tdms          ← 一个文件包含所有数据
    ├── time_s              (时间轴)
    ├── sine                (原始信号)
    ├── noise               (噪声)
    └── sine_plus_noise     (混合信号 = 原始 + 噪声)
```

**特点**：
- ✅ 所有数据在**一个文件**里
- ✅ 按**通道**（Channel）分开
- ✅ 可以直接从一个文件中提取所有需要的信号

### Signal-2 文件夹（多文件组合）
```
signal-2/
├── ae_sine_2s.tdms         ← 原始正弦波信号
├── ae_noise_2s.tdms        ← 纯噪声信号
└── ae_mix_2s.tdms          ← 混合信号（原始 + 噪声）
```

**特点**：
- ✅ 数据分成**三个独立文件**
- ✅ 需要**一起读取**所有文件才能对比分析
- ✅ 可以看到噪声是如何影响信号的

---

## 🔧 更新内容

### 1. 前端界面更新

#### 之前（文件模式）
```
[文件列表]
├─ ae_sim_2s.tdms
├─ ae_sine_2s.tdms
├─ ae_noise_2s.tdms
└─ ae_mix_2s.tdms
```
❌ 问题：无法理解文件之间的关系

#### 现在（文件夹模式）
```
[📁 Signal-1 文件夹]        [📁 Signal-2 文件夹]
单文件多通道                多文件组合（3个文件）
点击分析整个文件夹           点击分析整个文件夹
├─ ae_sim_2s.tdms           ├─ ae_sine_2s.tdms
                            ├─ ae_noise_2s.tdms
                            └─ ae_mix_2s.tdms
```
✅ 优势：
- 一次点击分析整个文件夹
- 自动读取所有相关文件
- 智能组合分析

### 2. 后端API更新

#### 新增接口
```javascript
POST /api/tdms/analyze-folder
```

**请求参数**：
```json
{
  "folder": "signal-1",      // 或 "signal-2"
  "sampleRate": 100000,
  "cutoffFreq": 10000,
  "filterOrder": 6
}
```

**功能**：
- 自动识别文件夹类型
- Signal-1：读取单文件，提取多通道
- Signal-2：读取三个文件，组合分析

### 3. Python分析脚本

#### 新文件：`tdms-folder-analyzer.py`

**功能**：
- ✅ 处理 Signal-1：从单文件中提取多通道
- ✅ 处理 Signal-2：读取并组合三个文件
- ✅ 应用滤波器
- ✅ 计算性能指标
- ✅ 返回JSON格式结果

---

## 🎨 使用方法

### 1. 打开TDMS信号查看器
```
登录系统 → 实时监控 → TDMS信号查看器
```

### 2. 选择文件夹
界面上会显示两个卡片：

**左侧卡片**：
```
📁 Signal-1 文件夹
[单文件多通道]
点击分析整个文件夹
```

**右侧卡片**：
```
📁 Signal-2 文件夹
[多文件组合（3个文件）]
点击分析整个文件夹
```

### 3. 点击文件夹
- 点击 Signal-1 或 Signal-2 文件夹
- 系统会显示文件夹信息
- 显示包含的文件列表

### 4. 开始分析
- 点击"开始分析"按钮
- 系统会：
  - ✅ 自动读取文件夹中的所有相关文件
  - ✅ 提取原始信号、噪声、混合信号
  - ✅ 应用滤波器
  - ✅ 计算性能指标
  - ✅ 显示4个对比图

### 5. 查看结果
- **图表1**：原始信号（纯净的正弦波）
- **图表2**：加噪信号（被噪声污染）
- **图表3**：滤波后信号（噪声被去除）
- **图表4**：效果对比（原始 vs 滤波后）

---

## 📈 分析结果说明

### Signal-1 分析
```
模式：单文件多通道
文件：ae_sim_2s.tdms
通道：
  - sine：原始信号
  - noise：噪声
  - sine_plus_noise：混合信号
  
处理流程：
1. 读取 ae_sim_2s.tdms
2. 提取 sine 通道（原始）
3. 提取 sine_plus_noise 通道（加噪）
4. 对加噪信号应用低通滤波
5. 对比原始 vs 滤波后
```

### Signal-2 分析
```
模式：多文件组合
文件：
  - ae_sine_2s.tdms（原始）
  - ae_noise_2s.tdms（噪声）
  - ae_mix_2s.tdms（混合）
  
处理流程：
1. 读取 ae_sine_2s.tdms → 原始信号
2. 读取 ae_noise_2s.tdms → 噪声信号
3. 读取 ae_mix_2s.tdms → 混合信号
4. 对混合信号应用低通滤波
5. 对比原始 vs 滤波后
6. 额外显示纯噪声信号
```

---

## 🔍 为什么需要一起读取？

### 对比分析需要
```
原始信号  +  噪声  =  混合信号
   ↓          ↓         ↓
  干净      污染      污染后
   ↓          ↓         ↓
            对比     滤波处理
              ↓         ↓
             效果评估 ← 恢复
```

### 性能评估需要
- **MSE（均方误差）**：需要原始信号作为基准
- **相关系数**：需要对比原始和滤波后的相似度
- **频谱分析**：需要看到噪声的频率分布

### 可视化需要
- **4个子图对比**：
  1. 原始（参考基准）
  2. 加噪（污染程度）
  3. 滤波后（恢复效果）
  4. 叠加对比（直观评估）

---

## 💡 技术细节

### 自动识别逻辑

```python
if folder == 'signal-1':
    # 单文件多通道模式
    - 读取 ae_sim_2s.tdms
    - 遍历所有通道
    - 提取 'sine' 和 'sine_plus_noise' 通道
    
elif folder == 'signal-2':
    # 多文件组合模式
    - 读取 ae_sine_2s.tdms → sine_signal
    - 读取 ae_noise_2s.tdms → noise_signal
    - 读取 ae_mix_2s.tdms → mix_signal
    - 组合所有信号用于分析
```

### 滤波器配置

```python
滤波器类型：巴特沃斯低通滤波器
截止频率：10 kHz
阶数：6
信号频率：5 kHz（在截止频率之下，会保留）
噪声频率：宽频（高频部分会被抑制）
```

### 性能指标

```python
MSE改善 = (1 - MSE_after / MSE_before) × 100%
相关系数：0到1之间，越接近1越相似

典型值：
- MSE改善：85%以上
- 滤波后相关系数：0.98以上
```

---

## 🎉 优势总结

### ✅ 用户友好
- 不需要了解专业术语
- 一键点击文件夹即可
- 自动处理所有文件关系

### ✅ 智能分析
- 自动识别文件夹类型
- 自动组合相关文件
- 自动计算性能指标

### ✅ 可视化清晰
- 4个子图直观对比
- 时间窗口可调
- 性能指标实时显示

### ✅ 专业准确
- 科学的滤波算法
- 准确的性能评估
- 详细的参数说明

---

## 📝 使用建议

### 第一次使用
1. 先点击 **Signal-1** 文件夹
2. 查看单文件多通道模式
3. 理解基本的滤波原理

### 深入分析
1. 点击 **Signal-2** 文件夹
2. 查看多文件组合模式
3. 对比两种数据组织方式

### 参数调整
1. 调整时间窗口（5ms - 50ms）
2. 观察不同时间尺度的信号细节
3. 对比滤波前后的差异

---

## ⚠️ 注意事项

1. **文件夹完整性**
   - 确保所有文件都在对应文件夹中
   - Signal-1 需要 ae_sim_2s.tdms
   - Signal-2 需要三个文件都存在

2. **TDMS API 服务器**
   - 必须运行 TDMS API 服务器
   - 端口：3002
   - 启动方式：`node tdms-api-server.js`

3. **Python 依赖**
   - 需要安装：nptdms, numpy, scipy
   - 安装命令：`pip install nptdms numpy scipy`

---

## 🎯 总结

现在系统能够：
1. ✅ **识别文件夹结构**：自动判断是单文件还是多文件
2. ✅ **组合读取文件**：一次读取所有相关文件
3. ✅ **完整分析流程**：原始 → 加噪 → 滤波 → 对比
4. ✅ **直观可视化**：4个子图清晰展示处理过程
5. ✅ **性能评估**：MSE和相关系数定量评估

**你的理解完全正确！文件夹里的内容确实需要一起读取，现在系统已经支持这个功能了！** 🎉

---

## 🔄 下一步

1. **刷新浏览器页面** (F5)
2. 进入 TDMS信号查看器
3. 点击文件夹而不是单个文件
4. 点击"开始分析"
5. 查看完整的分析结果

**现在就可以完整地分析信号数据了！** 🚀
