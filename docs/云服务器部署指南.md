# ğŸš€ å·¥ä¸šå¥åº·ç›‘æµ‹å¹³å° - é˜¿é‡Œäº‘Ubuntu 20.04éƒ¨ç½²æŒ‡å—

## ğŸ“‹ å½“å‰ç¯å¢ƒç¡®è®¤

âœ… **äº‘å‚å•†**: é˜¿é‡Œäº‘ECS  
âœ… **æ“ä½œç³»ç»Ÿ**: Ubuntu 20.04 LTS  
âœ… **è¿æ¥å·¥å…·**: XShell SSHå®¢æˆ·ç«¯  

### 1. æœåŠ¡å™¨é…ç½®è¦æ±‚

**æœ€ä½é…ç½®**ï¼š
- CPU: 2æ ¸
- å†…å­˜: 4GB
- ç¡¬ç›˜: 40GB SSD
- å¸¦å®½: 3Mbps

**æ¨èé…ç½®**ï¼ˆå®Œæ•´åŠŸèƒ½ï¼‰ï¼š
- CPU: 4æ ¸
- å†…å­˜: 8GB
- ç¡¬ç›˜: 100GB SSD
- å¸¦å®½: 5Mbps

### 2. éœ€è¦å¼€æ”¾çš„ç«¯å£

| ç«¯å£ | æœåŠ¡ | è¯´æ˜ |
|------|------|------|
| 22 | SSH | è¿œç¨‹è¿æ¥ |
| 80 | HTTP | Webè®¿é—® |
| 443 | HTTPS | å®‰å…¨è®¿é—® |
| 3000 | Frontend | å‰ç«¯å¼€å‘æœåŠ¡å™¨ |
| 3306 | MySQL | æ•°æ®åº“ |
| 6379 | Redis | ç¼“å­˜ |
| 8848 | Nacos | æ³¨å†Œä¸­å¿ƒ |
| 9092 | Kafka | æ¶ˆæ¯é˜Ÿåˆ— |
| 48080 | Gateway | APIç½‘å…³ |
| 48081-48084 | å¾®æœåŠ¡ | ä¸šåŠ¡æœåŠ¡ |

---

## ğŸ› ï¸ ç¬¬ä¸€æ­¥ï¼šä½¿ç”¨XShellè¿æ¥é˜¿é‡Œäº‘æœåŠ¡å™¨

### 1.1 è·å–æœåŠ¡å™¨ä¿¡æ¯

åœ¨é˜¿é‡Œäº‘ECSæ§åˆ¶å°è·å–ï¼š
- **å…¬ç½‘IP**: ä½ çš„æœåŠ¡å™¨å¤–ç½‘IP
- **ç”¨æˆ·å**: root æˆ– ubuntu
- **å¯†ç **: å®ä¾‹å¯†ç ï¼ˆæˆ–ä½¿ç”¨å¯†é’¥å¯¹ï¼‰

### 1.2 XShellè¿æ¥é…ç½®

1. **æ‰“å¼€XShell** â†’ æ–°å»ºä¼šè¯
2. **å¡«å†™è¿æ¥ä¿¡æ¯**ï¼š
   ```
   åç§°: é˜¿é‡Œäº‘-å·¥ä¸šç›‘æµ‹å¹³å°
   åè®®: SSH
   ä¸»æœº: ä½ çš„å…¬ç½‘IP
   ç«¯å£: 22
   ```
3. **ç”¨æˆ·èº«ä»½éªŒè¯**ï¼š
   ```
   æ–¹æ³•: Password
   ç”¨æˆ·å: root (æˆ– ubuntu)
   å¯†ç : ä½ çš„å®ä¾‹å¯†ç 
   ```
4. **ç‚¹å‡»è¿æ¥**

### 1.3 é¦–æ¬¡è¿æ¥éªŒè¯

```bash
# è¿æ¥æˆåŠŸåï¼Œæ£€æŸ¥ç³»ç»Ÿä¿¡æ¯
uname -a
lsb_release -a
whoami
pwd
```

åº”è¯¥çœ‹åˆ°ç±»ä¼¼è¾“å‡ºï¼š
```
Ubuntu 20.04.x LTS
root (æˆ– ubuntu)
/root (æˆ– /home/ubuntu)
```

---

## ğŸ”§ ç¬¬äºŒæ­¥ï¼šå®‰è£…åŸºç¡€ç¯å¢ƒï¼ˆUbuntu 20.04ï¼‰

### 2.1 æ›´æ–°ç³»ç»ŸåŒ…

```bash
# æ›´æ–°åŒ…åˆ—è¡¨
sudo apt update

# å‡çº§å·²å®‰è£…çš„åŒ…
sudo apt upgrade -y

# å®‰è£…åŸºç¡€å·¥å…·
sudo apt install -y curl wget vim unzip htop
```

### 2.2 å®‰è£…Java 8

```bash
# å®‰è£…OpenJDK 8
sudo apt install -y openjdk-8-jdk

# é…ç½®JAVA_HOME
echo 'export JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64' >> ~/.bashrc
echo 'export PATH=$PATH:$JAVA_HOME/bin' >> ~/.bashrc
source ~/.bashrc

# éªŒè¯å®‰è£…
java -version
javac -version
```

**é¢„æœŸè¾“å‡º**ï¼š
```
openjdk version "1.8.0_xxx"
OpenJDK Runtime Environment (build 1.8.0_xxx)
```

### 2.3 å®‰è£…Node.js 16+

```bash
# æ·»åŠ NodeSourceä»“åº“
curl -fsSL https://deb.nodesource.com/setup_16.x | sudo -E bash -

# å®‰è£…Node.js
sudo apt-get install -y nodejs

# éªŒè¯å®‰è£…
node --version
npm --version

# é…ç½®npmé•œåƒï¼ˆåŠ é€Ÿä¸‹è½½ï¼‰
npm config set registry https://registry.npmmirror.com
```

**é¢„æœŸè¾“å‡º**ï¼š
```
v16.x.x
8.x.x
```

### 2.4 å®‰è£…Git

```bash
# å®‰è£…Git
sudo apt install -y git

# é…ç½®Gitï¼ˆå¯é€‰ï¼‰
git config --global user.name "ä½ çš„åå­—"
git config --global user.email "ä½ çš„é‚®ç®±"

# éªŒè¯å®‰è£…
git --version
```

---

## ğŸ“¦ ç¬¬ä¸‰æ­¥ï¼šå®‰è£…æ•°æ®åº“å’Œä¸­é—´ä»¶

### 3.1 å®‰è£…MySQL 8.0

```bash
# å®‰è£…MySQLæœåŠ¡å™¨
sudo apt install -y mysql-server

# å¯åŠ¨å¹¶è®¾ç½®å¼€æœºè‡ªå¯
sudo systemctl start mysql
sudo systemctl enable mysql

# æ£€æŸ¥MySQLçŠ¶æ€
sudo systemctl status mysql

# å®‰å…¨é…ç½®MySQL
sudo mysql_secure_installation
```

**MySQLå®‰å…¨é…ç½®æ­¥éª¤**ï¼š
1. å¯†ç å¤æ‚åº¦éªŒè¯ï¼šnï¼ˆä¸éœ€è¦ï¼‰
2. è®¾ç½®rootå¯†ç ï¼š`123456`
3. ç§»é™¤åŒ¿åç”¨æˆ·ï¼šY
4. ç¦æ­¢rootè¿œç¨‹ç™»å½•ï¼šnï¼ˆæˆ‘ä»¬éœ€è¦è¿œç¨‹è¿æ¥ï¼‰
5. ç§»é™¤testæ•°æ®åº“ï¼šY
6. é‡æ–°åŠ è½½æƒé™è¡¨ï¼šY

**é…ç½®MySQLæ•°æ®åº“**ï¼š
```bash
# ç™»å½•MySQLï¼ˆä½¿ç”¨åˆšè®¾ç½®çš„å¯†ç ï¼‰
mysql -u root -p
# è¾“å…¥å¯†ç ï¼š123456
```

**åœ¨MySQLå‘½ä»¤è¡Œä¸­æ‰§è¡Œä»¥ä¸‹SQL**ï¼š
```sql
-- åˆ›å»ºé¡¹ç›®æ•°æ®åº“
CREATE DATABASE ruoyi_vue_pro CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE DATABASE nacos_config CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- é…ç½®rootç”¨æˆ·è¿œç¨‹è¿æ¥
ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY '123456';
CREATE USER 'root'@'%' IDENTIFIED WITH mysql_native_password BY '123456';
GRANT ALL PRIVILEGES ON *.* TO 'root'@'%' WITH GRANT OPTION;

-- åˆ·æ–°æƒé™
FLUSH PRIVILEGES;

-- æŸ¥çœ‹åˆ›å»ºçš„æ•°æ®åº“
SHOW DATABASES;

-- é€€å‡ºMySQL
EXIT;
```

**æµ‹è¯•æ•°æ®åº“è¿æ¥**ï¼š
```bash
# æµ‹è¯•è¿æ¥
mysql -u root -p123456 -e "SHOW DATABASES;"
```

**åº”è¯¥çœ‹åˆ°è¾“å‡º**ï¼š
```
+--------------------+
| Database           |
+--------------------+
| information_schema |
| mysql              |
| nacos_config       |
| performance_schema |
| ruoyi_vue_pro      |
| sys                |
+--------------------+
```

### 3.2 å®‰è£…Redis

```bash
# å®‰è£…Redis
sudo apt install -y redis-server

# å¯åŠ¨å¹¶è®¾ç½®å¼€æœºè‡ªå¯
sudo systemctl start redis-server
sudo systemctl enable redis-server

# æ£€æŸ¥RedisçŠ¶æ€
sudo systemctl status redis-server

# æµ‹è¯•Redisè¿æ¥
redis-cli ping
```

**é¢„æœŸè¾“å‡º**ï¼š`PONG`

**é…ç½®Redisï¼ˆå¯é€‰ï¼‰**ï¼š
```bash
# ç¼–è¾‘Redisé…ç½®
sudo vim /etc/redis/redis.conf

# æ‰¾åˆ°ä»¥ä¸‹è¡Œå¹¶ä¿®æ”¹ï¼ˆå¦‚éœ€è¿œç¨‹è¿æ¥ï¼‰ï¼š
# bind 127.0.0.1 ::1  æ”¹ä¸º  bind 0.0.0.0
# è®¾ç½®å¯†ç ï¼ˆå¯é€‰ï¼‰ï¼š
# requirepass 123456

# é‡å¯Redisä½¿é…ç½®ç”Ÿæ•ˆ
sudo systemctl restart redis-server
```

### 3.3 å®‰è£…Maven

```bash
# ä¸‹è½½å¹¶å®‰è£…Maven
cd /tmp
wget https://downloads.apache.org/maven/maven-3/3.9.5/binaries/apache-maven-3.9.5-bin.tar.gz
sudo tar -xzf apache-maven-3.9.5-bin.tar.gz -C /opt/
sudo ln -s /opt/apache-maven-3.9.5 /opt/maven

# é…ç½®Mavenç¯å¢ƒå˜é‡
echo 'export MAVEN_HOME=/opt/maven' >> ~/.bashrc
echo 'export PATH=$PATH:$MAVEN_HOME/bin' >> ~/.bashrc
source ~/.bashrc

# éªŒè¯Mavenå®‰è£…
mvn --version
```

### 3.4 å®‰è£…Kafkaï¼ˆå¯é€‰ - å®Œæ•´åŠŸèƒ½éœ€è¦ï¼‰

```bash
# åˆ›å»ºkafkaç›®å½•
sudo mkdir -p /opt/kafka
cd /opt/kafka

# ä¸‹è½½Kafka
sudo wget https://downloads.apache.org/kafka/2.13-3.6.0/kafka_2.13-3.6.0.tgz
sudo tar -xzf kafka_2.13-3.6.0.tgz
sudo ln -s kafka_2.13-3.6.0 current
sudo chown -R $USER:$USER /opt/kafka

# é…ç½®ç¯å¢ƒå˜é‡
echo 'export KAFKA_HOME=/opt/kafka/current' >> ~/.bashrc
echo 'export PATH=$PATH:$KAFKA_HOME/bin' >> ~/.bashrc
source ~/.bashrc

# éªŒè¯å®‰è£…
ls -la /opt/kafka/current/bin/
```

---

## ğŸ“ ç¬¬å››æ­¥ï¼šä¸Šä¼ é¡¹ç›®ä»£ç 

### 4.1 åˆ›å»ºé¡¹ç›®ç›®å½•

```bash
# åˆ›å»ºé¡¹ç›®ç›®å½•
sudo mkdir -p /opt/cw-cloud
sudo chown $USER:$USER /opt/cw-cloud
cd /opt/cw-cloud
```

### 4.2 ä¸Šä¼ ä»£ç ï¼ˆæ¨èæ–¹æ³•ï¼‰

**æ–¹æ³•1ï¼šä½¿ç”¨XShellçš„æ–‡ä»¶ä¼ è¾“åŠŸèƒ½**

1. åœ¨XShellä¸­æŒ‰ `Ctrl + Alt + F` æ‰“å¼€XFTP
2. æˆ–è€…ç‚¹å‡»å·¥å…·æ çš„"æ–°å»ºæ–‡ä»¶ä¼ è¾“"æŒ‰é’®
3. å·¦ä¾§é€‰æ‹©æœ¬åœ°é¡¹ç›®ç›®å½•ï¼š`e:\Code\CW_Cloud`
4. å³ä¾§å¯¼èˆªåˆ°ï¼š`/opt/cw-cloud`
5. é€‰æ‹©æ‰€æœ‰æ–‡ä»¶ï¼Œæ‹–æ‹½ä¸Šä¼ 

**æ–¹æ³•2ï¼šä½¿ç”¨SCPå‘½ä»¤ï¼ˆåœ¨æœ¬åœ°Windows PowerShellæ‰§è¡Œï¼‰**
```powershell
# å‹ç¼©é¡¹ç›®ï¼ˆåœ¨æœ¬åœ°æ‰§è¡Œï¼‰
cd e:\Code\CW_Cloud
tar -czf cw-cloud.tar.gz *

# ä¸Šä¼ åˆ°æœåŠ¡å™¨
scp cw-cloud.tar.gz root@ä½ çš„æœåŠ¡å™¨IP:/opt/cw-cloud/
```

**æ–¹æ³•3ï¼šä½¿ç”¨Gitï¼ˆå¦‚æœä»£ç å·²ä¸Šä¼ åˆ°GitHubï¼‰**
```bash
# åœ¨æœåŠ¡å™¨æ‰§è¡Œ
cd /opt/cw-cloud
git clone https://github.com/ä½ çš„ç”¨æˆ·å/CW_Cloud.git .
```

### 4.3 è§£å‹å¹¶æ£€æŸ¥æ–‡ä»¶

```bash
# å¦‚æœä½¿ç”¨äº†å‹ç¼©åŒ…æ–¹å¼
cd /opt/cw-cloud
tar -xzf cw-cloud.tar.gz

# æ£€æŸ¥æ–‡ä»¶ç»“æ„
ls -la
```

**åº”è¯¥çœ‹åˆ°ä»¥ä¸‹ç›®å½•ç»“æ„**ï¼š
```
yudao-cloud/                 # åç«¯å¾®æœåŠ¡
yudao-ui-admin-vue3/         # å‰ç«¯é¡¹ç›®
backend.jar                  # å®æ—¶æ»¤æ³¢æœåŠ¡
README.md                    # é¡¹ç›®è¯´æ˜
quick-start.bat              # å¯åŠ¨è„šæœ¬
...
```

---

## ğŸ” ç¬¬äº”æ­¥ï¼šé…ç½®é˜¿é‡Œäº‘å®‰å…¨ç»„

### 5.1 åœ¨é˜¿é‡Œäº‘æ§åˆ¶å°é…ç½®å®‰å…¨ç»„

1. **ç™»å½•é˜¿é‡Œäº‘æ§åˆ¶å°** â†’ ECS â†’ å®ä¾‹
2. **ç‚¹å‡»ä½ çš„å®ä¾‹** â†’ å®‰å…¨ç»„ â†’ é…ç½®è§„åˆ™
3. **æ·»åŠ å…¥æ–¹å‘è§„åˆ™**ï¼š

| ç«¯å£èŒƒå›´ | æˆæƒå¯¹è±¡ | æè¿° |
|---------|---------|------|
| 22/22 | 0.0.0.0/0 | SSHè¿æ¥ |
| 80/80 | 0.0.0.0/0 | HTTPè®¿é—® |
| 443/443 | 0.0.0.0/0 | HTTPSè®¿é—® |
| 3000/3000 | 0.0.0.0/0 | å‰ç«¯å¼€å‘æœåŠ¡å™¨ |
| 8848/8848 | 0.0.0.0/0 | Nacosæ§åˆ¶å° |
| 48080/48080 | 0.0.0.0/0 | APIç½‘å…³ |
| 3306/3306 | ä½ çš„IP/32 | MySQLï¼ˆä»…ä½ çš„IPï¼‰ |

### 5.2 é…ç½®Ubuntué˜²ç«å¢™

```bash
# æ£€æŸ¥é˜²ç«å¢™çŠ¶æ€
sudo ufw status

# å¦‚æœé˜²ç«å¢™æ˜¯æ¿€æ´»çš„ï¼Œæ·»åŠ è§„åˆ™
sudo ufw allow 22
sudo ufw allow 80
sudo ufw allow 443
sudo ufw allow 3000
sudo ufw allow 8848
sudo ufw allow 48080

# é‡æ–°åŠ è½½é˜²ç«å¢™
sudo ufw reload
```

## ğŸ”¨ ç¬¬å…­æ­¥ï¼šç¼–è¯‘é¡¹ç›®

### 6.1 ä¿®æ”¹åç«¯é…ç½®

```bash
cd /opt/cw-cloud/yudao-cloud

# å¤‡ä»½åŸé…ç½®æ–‡ä»¶
cp yudao-server/src/main/resources/application-local.yaml yudao-server/src/main/resources/application-local.yaml.bak

# ç¼–è¾‘é…ç½®æ–‡ä»¶
vim yudao-server/src/main/resources/application-local.yaml
```

**ä¿®æ”¹æ•°æ®åº“é…ç½®**ï¼ˆåœ¨vimä¸­æŒ‰ `i` è¿›å…¥ç¼–è¾‘æ¨¡å¼ï¼‰ï¼š
```yaml
spring:
  # æ•°æ®æºé…ç½®é¡¹
  datasource:
    druid:
      primary:
        name: ruoyi-vue-pro
        url: jdbc:mysql://localhost:3306/ruoyi_vue_pro?useSSL=false&serverTimezone=Asia/Shanghai&allowPublicKeyRetrieval=true&nullCatalogMeansCurrent=true
        driver-class-name: com.mysql.cj.jdbc.Driver
        username: root
        password: 123456
  # Redis é…ç½®
  redis:
    host: localhost
    port: 6379
    database: 0
    # password: 123456  # å¦‚æœè®¾ç½®äº†Rediså¯†ç 
```

**ä¿å­˜å¹¶é€€å‡º**ï¼šæŒ‰ `Esc`ï¼Œè¾“å…¥ `:wq`ï¼ŒæŒ‰å›è½¦

### 6.2 ç¼–è¯‘åç«¯é¡¹ç›®

```bash
# ç¼–è¯‘é¡¹ç›®ï¼ˆé¦–æ¬¡ç¼–è¯‘å¯èƒ½éœ€è¦10-15åˆ†é’Ÿï¼‰
cd /opt/cw-cloud/yudao-cloud
mvn clean package -DskipTests

# æ£€æŸ¥ç¼–è¯‘ç»“æœ
ls -la yudao-server/target/yudao-server.jar
```

**å¦‚æœç¼–è¯‘æˆåŠŸï¼Œåº”è¯¥çœ‹åˆ°**ï¼š
```
-rw-r--r-- 1 root root çº¦100MB yudao-server.jar
```

### 6.3 é…ç½®å‰ç«¯é¡¹ç›®

```bash
cd /opt/cw-cloud/yudao-ui-admin-vue3

# æ£€æŸ¥å‰ç«¯é…ç½®æ–‡ä»¶
cat .env.development
```

**ç¡®è®¤é…ç½®å†…å®¹**ï¼š
```env
# å¼€å‘ç¯å¢ƒé…ç½®
VITE_DEV = true

# è¯·æ±‚è·¯å¾„
VITE_BASE_URL = 'http://localhost:48080'

# ä¸Šä¼ è·¯å¾„
VITE_UPLOAD_URL = 'http://localhost:48080/admin-api/infra/file/upload'

# æ¥å£å‰ç¼€
VITE_API_BASEPATH = '/admin-api'

# æ‰“åŒ…è·¯å¾„
VITE_BASE_PATH = '/'

# æ˜¯å¦åˆ é™¤debugger
VITE_DROP_DEBUGGER = false

# æ˜¯å¦åˆ é™¤console.log
VITE_DROP_CONSOLE = false

# æ˜¯å¦sourcemap
VITE_SOURCEMAP = true

# è¾“å‡ºè·¯å¾„
VITE_OUT_DIR = 'dist'
```

### 6.4 å®‰è£…å‰ç«¯ä¾èµ–

```bash
# å®‰è£…ä¾èµ–ï¼ˆå¯èƒ½éœ€è¦5-10åˆ†é’Ÿï¼‰
npm install

# å¦‚æœå®‰è£…å¤±è´¥æˆ–å¾ˆæ…¢ï¼Œæ¸…é™¤ç¼“å­˜é‡è¯•
npm cache clean --force
npm install
```

---

## ğŸš€ ç¬¬ä¸ƒæ­¥ï¼šå®‰è£…å’Œé…ç½®Nacos

### 7.1 ä¸‹è½½å®‰è£…Nacos

```bash
# ä¸‹è½½Nacos
cd /opt
sudo wget https://github.com/alibaba/nacos/releases/download/2.2.3/nacos-server-2.2.3.tar.gz
sudo tar -xzf nacos-server-2.2.3.tar.gz
sudo chown -R $USER:$USER nacos

# è¿›å…¥Nacosç›®å½•
cd nacos
```

### 7.2 é…ç½®Nacosä½¿ç”¨MySQL

```bash
# å¤‡ä»½åŸé…ç½®
cp conf/application.properties conf/application.properties.bak

# ç¼–è¾‘é…ç½®æ–‡ä»¶
vim conf/application.properties
```

**åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ ä»¥ä¸‹é…ç½®**ï¼ˆæŒ‰ `i` è¿›å…¥ç¼–è¾‘æ¨¡å¼ï¼Œæ»šåŠ¨åˆ°æ–‡ä»¶æœ«å°¾ï¼‰ï¼š
```properties
### æ•°æ®åº“é…ç½®
spring.datasource.platform=mysql
db.num=1
db.url.0=jdbc:mysql://localhost:3306/nacos_config?characterEncoding=utf8&connectTimeout=1000&socketTimeout=3000&autoReconnect=true&useUnicode=true&useSSL=false&serverTimezone=UTC&allowPublicKeyRetrieval=true
db.user.0=root
db.password.0=123456

### å…³é—­é‰´æƒ
nacos.core.auth.enabled=false
```

**ä¿å­˜é€€å‡º**ï¼šæŒ‰ `Esc`ï¼Œè¾“å…¥ `:wq`

### 7.3 åˆå§‹åŒ–Nacosæ•°æ®åº“

```bash
# å¯¼å…¥Nacosæ•°æ®åº“è¡¨ç»“æ„
mysql -u root -p123456 nacos_config < /opt/nacos/conf/nacos-mysql.sql

# éªŒè¯è¡¨æ˜¯å¦åˆ›å»ºæˆåŠŸ
mysql -u root -p123456 -e "USE nacos_config; SHOW TABLES;"
```

### 7.4 å¯åŠ¨Nacos

```bash
# å¯åŠ¨Nacosï¼ˆå•æœºæ¨¡å¼ï¼‰
cd /opt/nacos/bin
./startup.sh -m standalone

# æ£€æŸ¥å¯åŠ¨æ—¥å¿—
tail -f /opt/nacos/logs/start.out
```

**ç­‰å¾…çœ‹åˆ°ä»¥ä¸‹æ—¥å¿—è¡¨ç¤ºå¯åŠ¨æˆåŠŸ**ï¼š
```
Nacos started successfully in stand alone mode. use external storage
```

**éªŒè¯Nacoså¯åŠ¨**ï¼š
```bash
# æ£€æŸ¥ç«¯å£ç›‘å¬
netstat -tlnp | grep 8848

# æ£€æŸ¥è¿›ç¨‹
ps aux | grep nacos
```

**è®¿é—®Nacosæ§åˆ¶å°**ï¼š
- åœ°å€ï¼š`http://ä½ çš„æœåŠ¡å™¨IP:8848/nacos`
- ç”¨æˆ·åï¼š`nacos`
- å¯†ç ï¼š`nacos`

## ğŸ¯ ç¬¬å…«æ­¥ï¼šåˆ›å»ºå¯åŠ¨è„šæœ¬

### 8.1 åˆ›å»ºæœåŠ¡å¯åŠ¨è„šæœ¬

```bash
cd /opt/cw-cloud

# åˆ›å»ºæ—¥å¿—å’ŒPIDç›®å½•
mkdir -p logs pids

# åˆ›å»ºå¯åŠ¨è„šæœ¬
cat > start-services.sh << 'EOF'
#!/bin/bash

echo "=== å¯åŠ¨å·¥ä¸šå¥åº·ç›‘æµ‹å¹³å° ==="
echo "æ—¶é—´: $(date)"

# åˆ›å»ºå¿…è¦ç›®å½•
mkdir -p logs pids

# æ£€æŸ¥åŸºç¡€æœåŠ¡
echo "æ£€æŸ¥åŸºç¡€æœåŠ¡çŠ¶æ€..."
systemctl is-active mysql || { echo "MySQLæœªå¯åŠ¨ï¼Œè¯·å…ˆå¯åŠ¨MySQL"; exit 1; }
systemctl is-active redis-server || { echo "Redisæœªå¯åŠ¨ï¼Œè¯·å…ˆå¯åŠ¨Redis"; exit 1; }

# æ£€æŸ¥Nacos
if ! pgrep -f "nacos" > /dev/null; then
    echo "å¯åŠ¨Nacos..."
    cd /opt/nacos/bin
    ./startup.sh -m standalone
    sleep 10
fi

# ç­‰å¾…Nacoså°±ç»ª
echo "ç­‰å¾…Nacoså¯åŠ¨å®Œæˆ..."
for i in {1..30}; do
    if curl -s http://localhost:8848/nacos > /dev/null; then
        echo "Nacoså·²å°±ç»ª"
        break
    fi
    echo "ç­‰å¾…Nacoså¯åŠ¨... ($i/30)"
    sleep 2
done

# å¯åŠ¨åç«¯å¾®æœåŠ¡
echo "å¯åŠ¨åç«¯å¾®æœåŠ¡..."
cd /opt/cw-cloud/yudao-cloud
nohup java -jar -Xms1g -Xmx2g yudao-server/target/yudao-server.jar --spring.profiles.active=local > ../logs/backend.log 2>&1 &
echo $! > ../pids/backend.pid
echo "åç«¯æœåŠ¡PID: $(cat ../pids/backend.pid)"

# ç­‰å¾…åç«¯å¯åŠ¨
echo "ç­‰å¾…åç«¯æœåŠ¡å¯åŠ¨..."
sleep 30

# å¯åŠ¨å‰ç«¯
echo "å¯åŠ¨å‰ç«¯æœåŠ¡..."
cd /opt/cw-cloud/yudao-ui-admin-vue3
nohup npm run dev -- --host 0.0.0.0 > ../logs/frontend.log 2>&1 &
echo $! > ../pids/frontend.pid
echo "å‰ç«¯æœåŠ¡PID: $(cat ../pids/frontend.pid)"

echo ""
echo "=== å¯åŠ¨å®Œæˆ ==="
echo "å‰ç«¯åœ°å€: http://$(curl -s ifconfig.me):3000"
echo "Nacosæ§åˆ¶å°: http://$(curl -s ifconfig.me):8848/nacos"
echo "APIç½‘å…³: http://$(curl -s ifconfig.me):48080"
echo ""
echo "é»˜è®¤ç™»å½•è´¦å·: admin / admin123"
echo ""
echo "æŸ¥çœ‹æ—¥å¿—:"
echo "  åç«¯: tail -f /opt/cw-cloud/logs/backend.log"
echo "  å‰ç«¯: tail -f /opt/cw-cloud/logs/frontend.log"
EOF

chmod +x start-services.sh
```

---

### 8.2 åˆ›å»ºåœæ­¢è„šæœ¬

```bash
cat > stop-services.sh << 'EOF'
#!/bin/bash

echo "=== åœæ­¢å·¥ä¸šå¥åº·ç›‘æµ‹å¹³å° ==="

# åœæ­¢å‰ç«¯
if [ -f pids/frontend.pid ]; then
    echo "åœæ­¢å‰ç«¯æœåŠ¡..."
    kill $(cat pids/frontend.pid) 2>/dev/null
    rm -f pids/frontend.pid
fi

# åœæ­¢åç«¯
if [ -f pids/backend.pid ]; then
    echo "åœæ­¢åç«¯æœåŠ¡..."
    kill $(cat pids/backend.pid) 2>/dev/null
    rm -f pids/backend.pid
fi

# å¼ºåˆ¶åœæ­¢ç›¸å…³è¿›ç¨‹
echo "æ¸…ç†æ®‹ç•™è¿›ç¨‹..."
pkill -f "yudao-server" 2>/dev/null
pkill -f "npm.*dev" 2>/dev/null
pkill -f "node.*vite" 2>/dev/null

# åœæ­¢Nacosï¼ˆå¯é€‰ï¼‰
# pkill -f "nacos" 2>/dev/null

echo "æ‰€æœ‰æœåŠ¡å·²åœæ­¢"
EOF

chmod +x stop-services.sh
```

### 8.3 åˆ›å»ºçŠ¶æ€æ£€æŸ¥è„šæœ¬

```bash
cat > check-status.sh << 'EOF'
#!/bin/bash

echo "=== ç³»ç»ŸçŠ¶æ€æ£€æŸ¥ ==="
echo "æ—¶é—´: $(date)"
echo ""

echo "=== åŸºç¡€æœåŠ¡çŠ¶æ€ ==="
echo "MySQL: $(systemctl is-active mysql)"
echo "Redis: $(systemctl is-active redis-server)"
echo "Nacos: $(pgrep -f nacos > /dev/null && echo "è¿è¡Œä¸­" || echo "æœªè¿è¡Œ")"
echo ""

echo "=== åº”ç”¨æœåŠ¡çŠ¶æ€ ==="
if [ -f pids/backend.pid ] && kill -0 $(cat pids/backend.pid) 2>/dev/null; then
    echo "åç«¯æœåŠ¡: è¿è¡Œä¸­ (PID: $(cat pids/backend.pid))"
else
    echo "åç«¯æœåŠ¡: æœªè¿è¡Œ"
fi

if [ -f pids/frontend.pid ] && kill -0 $(cat pids/frontend.pid) 2>/dev/null; then
    echo "å‰ç«¯æœåŠ¡: è¿è¡Œä¸­ (PID: $(cat pids/frontend.pid))"
else
    echo "å‰ç«¯æœåŠ¡: æœªè¿è¡Œ"
fi
echo ""

echo "=== ç«¯å£ç›‘å¬çŠ¶æ€ ==="
netstat -tlnp 2>/dev/null | grep -E "(3000|3306|6379|8848|48080)" | while read line; do
    port=$(echo $line | awk '{print $4}' | cut -d: -f2)
    echo "ç«¯å£ $port: ç›‘å¬ä¸­"
done
echo ""

echo "=== å†…å­˜ä½¿ç”¨æƒ…å†µ ==="
free -h
echo ""

echo "=== ç£ç›˜ä½¿ç”¨æƒ…å†µ ==="
df -h /
EOF

chmod +x check-status.sh
```

### 7.2 åˆ›å»ºåœæ­¢è„šæœ¬

```bash
cat > stop-services.sh << 'EOF'
#!/bin/bash

echo "åœæ­¢æ‰€æœ‰æœåŠ¡..."

# åˆ›å»ºç›®å½•
mkdir -p pids logs

# åœæ­¢æœåŠ¡
if [ -f pids/gateway.pid ]; then
    kill $(cat pids/gateway.pid) 2>/dev/null
    rm pids/gateway.pid
fi

if [ -f pids/frontend.pid ]; then
    kill $(cat pids/frontend.pid) 2>/dev/null
    rm pids/frontend.pid
fi

# å¼ºåˆ¶åœæ­¢Javaè¿›ç¨‹
pkill -f "yudao-server"
pkill -f "node.*dev"

echo "æ‰€æœ‰æœåŠ¡å·²åœæ­¢"
EOF

chmod +x stop-services.sh
```

---

## ğŸ”¥ ç¬¬ä¹æ­¥ï¼šå¯åŠ¨ç³»ç»Ÿ

### 9.1 é¦–æ¬¡å¯åŠ¨

```bash
cd /opt/cw-cloud

# å¯åŠ¨æ‰€æœ‰æœåŠ¡
./start-services.sh
```

**å¯åŠ¨è¿‡ç¨‹è¯´æ˜**ï¼š
1. æ£€æŸ¥MySQLã€RedisçŠ¶æ€
2. å¯åŠ¨Nacosï¼ˆå¦‚æœæœªè¿è¡Œï¼‰
3. ç­‰å¾…Nacoså°±ç»ªï¼ˆæœ€å¤š60ç§’ï¼‰
4. å¯åŠ¨åç«¯å¾®æœåŠ¡
5. ç­‰å¾…åç«¯å¯åŠ¨ï¼ˆ30ç§’ï¼‰
6. å¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡å™¨

### 9.2 æŸ¥çœ‹å¯åŠ¨æ—¥å¿—

```bash
# æŸ¥çœ‹åç«¯å¯åŠ¨æ—¥å¿—
tail -f logs/backend.log

# æŸ¥çœ‹å‰ç«¯å¯åŠ¨æ—¥å¿—  
tail -f logs/frontend.log

# æŸ¥çœ‹Nacosæ—¥å¿—
tail -f /opt/nacos/logs/start.out
```

### 9.3 æ£€æŸ¥æœåŠ¡çŠ¶æ€

```bash
# ä½¿ç”¨çŠ¶æ€æ£€æŸ¥è„šæœ¬
./check-status.sh

# æ‰‹åŠ¨æ£€æŸ¥ç«¯å£
netstat -tlnp | grep -E "(3000|3306|6379|8848|48080)"
```

**æ­£å¸¸è¿è¡Œæ—¶åº”è¯¥çœ‹åˆ°**ï¼š
```
ç«¯å£ 3000: ç›‘å¬ä¸­  (å‰ç«¯)
ç«¯å£ 3306: ç›‘å¬ä¸­  (MySQL)
ç«¯å£ 6379: ç›‘å¬ä¸­  (Redis)
ç«¯å£ 8848: ç›‘å¬ä¸­  (Nacos)
ç«¯å£ 48080: ç›‘å¬ä¸­ (åç«¯ç½‘å…³)
```

---

## ğŸŒ ç¬¬åæ­¥ï¼šè®¿é—®å’ŒéªŒè¯ç³»ç»Ÿ

### 10.1 è·å–è®¿é—®åœ°å€

```bash
# è·å–æœåŠ¡å™¨å…¬ç½‘IP
curl ifconfig.me
```

### 10.2 è®¿é—®ç³»ç»Ÿ

**å‰ç«¯ç®¡ç†ç•Œé¢**ï¼š
- åœ°å€ï¼š`http://ä½ çš„æœåŠ¡å™¨IP:3000`
- ç”¨æˆ·åï¼š`admin`
- å¯†ç ï¼š`admin123`

**Nacosæ§åˆ¶å°**ï¼š
- åœ°å€ï¼š`http://ä½ çš„æœåŠ¡å™¨IP:8848/nacos`
- ç”¨æˆ·åï¼š`nacos`
- å¯†ç ï¼š`nacos`

**APIç½‘å…³**ï¼š
- åœ°å€ï¼š`http://ä½ çš„æœåŠ¡å™¨IP:48080`

### 10.3 éªŒè¯åŠŸèƒ½

1. **ç™»å½•æµ‹è¯•**ï¼š
   - è®¿é—®å‰ç«¯åœ°å€
   - ä½¿ç”¨admin/admin123ç™»å½•
   - æ£€æŸ¥æ˜¯å¦èƒ½æ­£å¸¸è¿›å…¥ç³»ç»Ÿ

2. **æœåŠ¡æ³¨å†Œæ£€æŸ¥**ï¼š
   - è®¿é—®Nacosæ§åˆ¶å°
   - æŸ¥çœ‹"æœåŠ¡ç®¡ç†" â†’ "æœåŠ¡åˆ—è¡¨"
   - åº”è¯¥çœ‹åˆ°æ³¨å†Œçš„å¾®æœåŠ¡

3. **APIæµ‹è¯•**ï¼š
   ```bash
   # æµ‹è¯•ç½‘å…³å¥åº·æ£€æŸ¥
   curl http://localhost:48080/actuator/health
   ```

---

## ğŸ”§ ç¬¬åä¸€æ­¥ï¼šæ•…éšœæ’æŸ¥

### 11.1 å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

**é—®é¢˜1ï¼šå‰ç«¯æ— æ³•è®¿é—®**
```bash
# æ£€æŸ¥å‰ç«¯è¿›ç¨‹
ps aux | grep "npm.*dev"

# æ£€æŸ¥å‰ç«¯æ—¥å¿—
tail -f logs/frontend.log

# é‡å¯å‰ç«¯
pkill -f "npm.*dev"
cd yudao-ui-admin-vue3
nohup npm run dev -- --host 0.0.0.0 > ../logs/frontend.log 2>&1 &
```

**é—®é¢˜2ï¼šåç«¯å¯åŠ¨å¤±è´¥**
```bash
# æ£€æŸ¥åç«¯æ—¥å¿—
tail -f logs/backend.log

# å¸¸è§åŸå› ï¼š
# 1. æ•°æ®åº“è¿æ¥å¤±è´¥ - æ£€æŸ¥MySQLé…ç½®
# 2. Nacosè¿æ¥å¤±è´¥ - æ£€æŸ¥NacosçŠ¶æ€
# 3. ç«¯å£è¢«å ç”¨ - æ£€æŸ¥ç«¯å£ä½¿ç”¨æƒ…å†µ
```

**é—®é¢˜3ï¼šNacosæ— æ³•è®¿é—®**
```bash
# æ£€æŸ¥Nacosè¿›ç¨‹
ps aux | grep nacos

# é‡å¯Nacos
pkill -f nacos
cd /opt/nacos/bin
./startup.sh -m standalone
```

**é—®é¢˜4ï¼šæ•°æ®åº“è¿æ¥å¤±è´¥**
```bash
# æµ‹è¯•æ•°æ®åº“è¿æ¥
mysql -u root -p123456 -e "SHOW DATABASES;"

# æ£€æŸ¥MySQLçŠ¶æ€
systemctl status mysql

# é‡å¯MySQL
sudo systemctl restart mysql
```

### 11.2 æ—¥å¿—æŸ¥çœ‹

```bash
# å®æ—¶æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—
tail -f logs/backend.log logs/frontend.log /opt/nacos/logs/start.out

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
grep -i error logs/backend.log
grep -i error logs/frontend.log
```

### 11.3 æ€§èƒ½ç›‘æ§

```bash
# æŸ¥çœ‹ç³»ç»Ÿèµ„æºä½¿ç”¨
htop

# æŸ¥çœ‹Javaè¿›ç¨‹å†…å­˜ä½¿ç”¨
ps aux | grep java

# æŸ¥çœ‹ç£ç›˜ç©ºé—´
df -h
```

---

## ğŸš€ ç¬¬åäºŒæ­¥ï¼šç³»ç»Ÿç»´æŠ¤

### 12.1 æ—¥å¸¸æ“ä½œå‘½ä»¤

```bash
# å¯åŠ¨ç³»ç»Ÿ
cd /opt/cw-cloud
./start-services.sh

# åœæ­¢ç³»ç»Ÿ
./stop-services.sh

# æ£€æŸ¥çŠ¶æ€
./check-status.sh

# é‡å¯ç³»ç»Ÿ
./stop-services.sh && sleep 5 && ./start-services.sh
```

### 12.2 è®¾ç½®å¼€æœºè‡ªå¯ï¼ˆå¯é€‰ï¼‰

```bash
# åˆ›å»ºsystemdæœåŠ¡æ–‡ä»¶
sudo tee /etc/systemd/system/cw-cloud.service > /dev/null << 'EOF'
[Unit]
Description=CW Cloud Industrial Monitoring Platform
After=network.target mysql.service redis-server.service

[Service]
Type=forking
User=root
WorkingDirectory=/opt/cw-cloud
ExecStart=/opt/cw-cloud/start-services.sh
ExecStop=/opt/cw-cloud/stop-services.sh
Restart=on-failure
RestartSec=10

[Install]
WantedBy=multi-user.target
EOF

# å¯ç”¨æœåŠ¡
sudo systemctl daemon-reload
sudo systemctl enable cw-cloud

# æµ‹è¯•æœåŠ¡
sudo systemctl start cw-cloud
sudo systemctl status cw-cloud
```

### 12.3 å¤‡ä»½å’Œæ¢å¤

```bash
# å¤‡ä»½æ•°æ®åº“
mysqldump -u root -p123456 ruoyi_vue_pro > backup_$(date +%Y%m%d).sql
mysqldump -u root -p123456 nacos_config > nacos_backup_$(date +%Y%m%d).sql

# å¤‡ä»½é…ç½®æ–‡ä»¶
tar -czf config_backup_$(date +%Y%m%d).tar.gz \
  /opt/cw-cloud/yudao-cloud/yudao-server/src/main/resources/application-local.yaml \
  /opt/nacos/conf/application.properties \
  /opt/cw-cloud/yudao-ui-admin-vue3/.env.development
```

---

## ğŸ¯ å¿«é€Ÿéƒ¨ç½²æ€»ç»“

### å®Œæ•´éƒ¨ç½²å‘½ä»¤ï¼ˆå¤åˆ¶ç²˜è´´æ‰§è¡Œï¼‰

```bash
# 1. æ›´æ–°ç³»ç»Ÿå¹¶å®‰è£…åŸºç¡€è½¯ä»¶
sudo apt update && sudo apt upgrade -y
sudo apt install -y curl wget vim unzip htop openjdk-8-jdk nodejs npm git mysql-server redis-server

# 2. é…ç½®ç¯å¢ƒå˜é‡
echo 'export JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64' >> ~/.bashrc
source ~/.bashrc

# 3. å®‰è£…Maven
cd /tmp && wget https://downloads.apache.org/maven/maven-3/3.9.5/binaries/apache-maven-3.9.5-bin.tar.gz
sudo tar -xzf apache-maven-3.9.5-bin.tar.gz -C /opt/
sudo ln -s /opt/apache-maven-3.9.5 /opt/maven
echo 'export MAVEN_HOME=/opt/maven' >> ~/.bashrc
echo 'export PATH=$PATH:$MAVEN_HOME/bin' >> ~/.bashrc
source ~/.bashrc

# 4. é…ç½®MySQLï¼ˆéœ€è¦å…ˆè¿è¡Œ mysql_secure_installation è®¾ç½®å¯†ç ä¸º 123456ï¼‰
mysql -u root -p123456 -e "CREATE DATABASE ruoyi_vue_pro CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;"
mysql -u root -p123456 -e "CREATE DATABASE nacos_config CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;"
mysql -u root -p123456 -e "ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY '123456';"
mysql -u root -p123456 -e "CREATE USER 'root'@'%' IDENTIFIED WITH mysql_native_password BY '123456';"
mysql -u root -p123456 -e "GRANT ALL PRIVILEGES ON *.* TO 'root'@'%' WITH GRANT OPTION;"
mysql -u root -p123456 -e "FLUSH PRIVILEGES;"

# 5. å®‰è£…Nacos
cd /opt && sudo wget https://github.com/alibaba/nacos/releases/download/2.2.3/nacos-server-2.2.3.tar.gz
sudo tar -xzf nacos-server-2.2.3.tar.gz && sudo chown -R $USER:$USER nacos

# 6. åˆ›å»ºé¡¹ç›®ç›®å½•
sudo mkdir -p /opt/cw-cloud && sudo chown $USER:$USER /opt/cw-cloud
```

### éƒ¨ç½²æ£€æŸ¥æ¸…å•

- [ ] æœåŠ¡å™¨é…ç½®ï¼š4æ ¸8GBä»¥ä¸Š
- [ ] å®‰å…¨ç»„å¼€æ”¾ï¼š22, 80, 443, 3000, 8848, 48080ç«¯å£
- [ ] XShellè¿æ¥æˆåŠŸ
- [ ] Java 8å®‰è£…æˆåŠŸ
- [ ] Node.js 16+å®‰è£…æˆåŠŸ
- [ ] MySQLé…ç½®å®Œæˆ
- [ ] Rediså¯åŠ¨æˆåŠŸ
- [ ] Mavenå®‰è£…æˆåŠŸ
- [ ] Nacosä¸‹è½½å®Œæˆ
- [ ] é¡¹ç›®ä»£ç ä¸Šä¼ å®Œæˆ

### ä¸‹ä¸€æ­¥æ“ä½œ

1. **ä¸Šä¼ é¡¹ç›®ä»£ç **åˆ° `/opt/cw-cloud/`
2. **é…ç½®Nacos**æ•°æ®åº“è¿æ¥
3. **ç¼–è¯‘åç«¯é¡¹ç›®**
4. **å®‰è£…å‰ç«¯ä¾èµ–**
5. **å¯åŠ¨æ‰€æœ‰æœåŠ¡**

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœåœ¨éƒ¨ç½²è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼š

1. **æ£€æŸ¥æ—¥å¿—**ï¼š`tail -f logs/backend.log`
2. **æŸ¥çœ‹çŠ¶æ€**ï¼š`./check-status.sh`
3. **é‡å¯æœåŠ¡**ï¼š`./stop-services.sh && ./start-services.sh`

**å¸¸ç”¨ç«¯å£è¯´æ˜**ï¼š
- 3000ï¼šå‰ç«¯ç•Œé¢
- 8848ï¼šNacosæ§åˆ¶å°  
- 48080ï¼šåç«¯APIç½‘å…³
- 3306ï¼šMySQLæ•°æ®åº“
- 6379ï¼šRedisç¼“å­˜

---

---

## ğŸ‰ éƒ¨ç½²å®Œæˆåçš„æ•ˆæœ

### ç³»ç»Ÿè®¿é—®åœ°å€
- **ç®¡ç†åå°**ï¼š`http://ä½ çš„IP:3000` (admin/admin123)
- **Nacosæ§åˆ¶å°**ï¼š`http://ä½ çš„IP:8848/nacos` (nacos/nacos)
- **APIæ–‡æ¡£**ï¼š`http://ä½ çš„IP:48080/doc.html`

### åŠŸèƒ½éªŒè¯
- âœ… ç”¨æˆ·ç™»å½•å’Œæƒé™ç®¡ç†
- âœ… ç³»ç»Ÿèœå•å’Œé¡µé¢è®¿é—®
- âœ… å¾®æœåŠ¡æ³¨å†Œå’Œå‘ç°
- âœ… æ•°æ®åº“è¿æ¥å’Œæ“ä½œ
- âœ… ç¼“å­˜æœåŠ¡æ­£å¸¸

---

**éƒ¨ç½²æŒ‡å—ç‰ˆæœ¬**ï¼šv1.0  
**é€‚ç”¨ç³»ç»Ÿ**ï¼šé˜¿é‡Œäº‘ Ubuntu 20.04 LTS  
**æ›´æ–°æ—¶é—´**ï¼š2025-12-15  

ğŸš€ **ç°åœ¨å¼€å§‹éƒ¨ç½²å§ï¼æŒ‰ç…§æ­¥éª¤ä¸€æ­¥æ­¥æ‰§è¡Œï¼Œé‡åˆ°é—®é¢˜éšæ—¶æŸ¥çœ‹æ•…éšœæ’æŸ¥éƒ¨åˆ†ã€‚**